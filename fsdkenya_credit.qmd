

```{r}
#| include: false

# Importing packaegs, declaring globals
source("R/packages.R")
source("R/utils.R")
source("R/globals.R")
source("R/functions_global.R")
source("R/functions_2021.R")
source("R/functions_2019.R")
source("R/dataviz_functions.R")

##########
# DATA PREP
###########

### 2021 ###
raw_data <- get_raw_data_fromfile(2021, "Anonymized Weighted FinAccess 2021.sav") # Importing FinAccess dataset (2021)
varbook <- gen_varbook_vec(raw_data) # Creating a named vector with all variable names and labels 
modglobal_indicator_reflist(raw_data) # Modifying the gloabl INDICATORS_REFLIST_LVL_LOAN
# Creating analysis datasets: 
borrower_data <- prep_borrower_data(raw_data) # 1 row per adult:
loans_data <- prep_loans_data(raw_data, borrower_data) # 1 row per loan
respdebt_data <- prep_respdebt_data(borrower_data, loans_data, "lender_agg3_str") # 1 row per adult-lender aggregate

### 2019 ###
raw_data_2019 <- get_raw_data_fromfile(2019, "FinAccess2018_new.sav")
varbook_2019 <- gen_varbook_vec(raw_data_2019)
# Creating analysis datasets: 
borrower_data_2019 <- prep_borrower_data(raw_data_2019)
loans_data_2019 <- prep_loans_data(raw_data_2019, borrower_data_2019)
respdebt_data_2019 <- prep_respdebt_data(borrower_data_2019, loans_data_2019, "lender_agg3_str")

# Data pools combining all years
borrower_data_pool <- bind_rows(borrower_data, borrower_data_2019)
loans_data_pool <- bind_rows(loans_data, loans_data_2019)
respdebt_data_pool <- bind_rows(respdebt_data, respdebt_data_2019)

```


## Introduction

The objective of this brief is to use nationally representative survey data to describe the market for credit in Kenya. How many adults use loans? Where do they borrow from? How much and why do they borrow? 

## 1. How large is the market for loans in Kenya? 

An estimated 76 million loans in Kenya were taken by borrowers in 2021.^[This total excludes purchases of goods on credit from shopkeepers, credit cards and loans from buyers of agricultural produce]. Over half of these loans (54%) were mobile money overdrafts using M-PESAâ€™s Fuliza service, and a further 12 percent were digital loans from mobile banking services (11%) or fintech apps (1%) (@fig-marketbyvol). Social networks (friends, family and neihbors) accounted for 20% of loans disbursed, while other informal sources such as Chamas (voluntary savings or investment groups), shopkeepers, employers or buyers collectively contributed around 10%. The data highlights that two-thirds of the demand for cash loans (by volume) in Kenya is satisfied through digital sources of credit, highlighting the significant role of mobile lending platforms in the market.


```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvol
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by volume"

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
  
plot_text <- list(
  title = "Figure 1. \n Total yearly volume of loans disbursed by lender (2021)",
  subtitle = "",
  caption = CAPTION
) 

# Total volume of loans: 
#get_indicator_total(loans_data, indicators, groups)

fig_tree_loans_by_volume(loans_data, indicators, groups, plot_text)

```

Between 2019 and 2021, the total volume of loans disbursed in Kenya decreased by 10%, from 83.1 million to 75.8 million. Digital loans remained the dominant form of borrowing, though their share declined from 74% (61.2 million) in 2019 to 66% (50 million) in 2021. The use of social networks for borrowing increased significantly, rising from 13% (10.3 million) in 2019 to 21% (15.5 million) in 2021. The volume of traditional loans from financial institutions (Banks, Saccos, MFIs) fell by nearly 1 million and their market share fell from 4% to 3%. 

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvolbyyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by volume, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  subtitle = "Total yearly volume of loans (millions) disbursed by lender and year",
  title = "Figure 2",
  caption = CAPTION
) 

plot_label <- list(
  type = "both", 
  threshold = 1.5e6, 
  nudge_y = 1e6, 
  ymax = 92e6
)

# Total volume of loans: 
#get_indicator_total(loans_data, indicators, groups)

fig_bar_loans_by_slice(loans_data_pool, indicators, slicevar, groups, plot_text, plot_label)

```

@fig-marketbyvolbywealthyear breaks the total volume of loans disbursed by both the source of the loan and the borrower's household wealth ^[Household wealth is proxied using data on the quality of housing conditions and household ownership of physical assets].

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvolbywealthyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by volume and borrower's household wealth, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Household wealth" = "hh_wlth_group")

plot_text <- list(
  subtitle = "Total yearly volume of loans (millions) disbursed by lender and borrower's household wealth, 2019 and 2021",
  title = "Figure 3",
  caption = CAPTION
) 

plot_label <- list(
  type = "both", 
  threshold = 1.75e6, 
  nudge_y = 0.5e6, 
  ymax = 35e6
)

# Total volume of loans: 
#get_indicator_total(loans_data, indicators, groups)

fig_bar_loans_by_hhwlth_year(loans_data_pool, indicators, slicevar, groups, plot_text, plot_label)

```

A total of KSh 978 billion was disbursed by lenders in 2021 (@fig-marketbyval). Banks were the largest source, disbursing KSh 340.4 billion (35%), followed by Sacco/MFIs at KSh 263.35 billion (27%). Digital loans, including mobile banking, Fuliza and lending apps, accounted for a combined value of KSh 113 billion (12%), while informal lenders including social network, chama and shopkeeper loans accounted for KSh 186 billion (19%). 


```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyval
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by value, 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
  
plot_text <- list(
  title = "Figure 4. \n Total yearly value of loans disbursed by lender (2021)",
  subtitle = "",
  caption = CAPTION
) 

#get_indicator_total(loans_data, indicators, groups)

fig_tree_loans_by_value(loans_data, indicators, groups, plot_text)

```
Compared to 2019, the total value of loans disbursed in 2021 fell by 30% (from KSh 1,420.5 to KSh 978 billion) (@fig-marketbyvalbyyear). Much of this decline is attributable to Bank lending which fell by over KSh 300 billion (from KSh 690 to 340 billion) and Sacco lending which fell by nearly KSh 100 billion. Loans from social networks partially offset this decline, which increased from KSh 80 billion (6% of the total) in 2019 to KSh 113 billion (12%) in 2021. 

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvalbyyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by value, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 5",
  subtitle = " Total yearly value of loans (KSh billions) disbursed by lender and year",
  caption = CAPTION
) 

plot_label <- list(
  type = "both", 
  threshold = 5e9, 
  nudge_y = 10e9, 
  ymax = 1500e9
)
#get_indicator_total(loans_data, indicators, groups)

fig_bar_loans_by_slice(loans_data_pool, indicators, slicevar, groups, plot_text, plot_label)

```

@fig-marketbyvalbywealthyear breaks the total value of loans disbursed by both the source of the loan and the borrower's household wealth and shows that the majority of the decline in the value of loan disbursements resulted from less credit flowing to borrowers in households ranking in the top 20% of the wealth distribution. The total value of Bank, Sacco and digital loans channeled to these wealthier borrowers collapsed by around 50% (from KSh 908 to Ksh 463 billion) between 2019 and 2021, while loans from friends and family rose by 50% (from KSh 33 to Ksh 50 billion). In contrast, the total value of loans disbursed to borrowers in households ranking the bottom 40% of the wealth distribution almost doubled, rising from KSh 56.1 billion in 2019 to KSh 98.1 billion in 2021. 

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvalbywealthyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by volume, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Household wealth" = "hh_wlth_group")

plot_text <- list(
  subtitle = "Total yearly value of loans (millions) disbursed by lender, household wealth & year",
  title = "Figure 6",
  caption = CAPTION
) 

plot_label <- list(
  type = "valueonly", 
  threshold = 20e9, 
  nudge_y = 10e9, 
  ymax = 1100e9
)

fig_bar_loans_by_hhwlth_year(loans_data_pool, indicators, slicevar, groups, plot_text, plot_label)

```

@fig-marketbysizesource shows the distribution of loans by the amount borrowed (the loan principal) and the source of the loan for 2019 and 2021. A dominant majority of loans (nearly 60%) were less than KSh 2,500 in both 2019 and 2021, just over 20 percent were between KSh 2,500 and KSh 10,000 and 15 percent were between KSh 10,000 and KSh 50,000. Shopkeeper loans and digital loans dominate the market for small loans while formal, non-digital loans from Banks and Saccos dominate the market for large loans. Between 2019 and 2021, the distribution of loans shifted moderately to smaller loans as the share of loans greater than KSh 50,000 fell. In 2021, Fuliza accounted for nearly 1 in 3 loans less than KSh 2,500 and appears to be crowding out shopkeeper credit whose share fell from 33.6% of small loans (< KSh 2,500) in 2019 to 23.4% of small loans in 2021 ^[This figure includes both cash loans from shopkeepers as well as purchases of goods and services on credit]. 

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbysizesource
#| echo: false
#| warning: false
#| fig-cap: "Loans by size and source, 2019 and 2021"

# Indicators used in this figure
indicators <- c("loan_principal_cat")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 7",
  subtitle = "Most recent loans by size and source",
  xaxis = "Loan principal (KES)", 
  yaxis= "Loans (%)", 
  caption = CAPTION
) 

fig_bar_loans_by_size_and_source(loans_data_pool, indicators, slicevar, groups, plot_text)

```

## 2. How prevalent are different forms of borrowing among adults?

In 2021, 56% of Kenyan adults were either currently borrowing or had attempted to borrow in the past year, with similar proportions for both men and women  (@fig-borrprevbytype). Two-thirds of these borrowers used informal options such as social networks, chamas, private moneylenders, employers, or buyers to address their credit needs.  Forty percent of this demand was satisfied by digital options, such as mobile banking, apps or Fuliza and 16 percent was met by traditional (non-digital) loans originating from financial institutions (commercial banks, SACCOs or MFIs). Between 2019 and 2021, the prevalence of bororwing increased from 52 to 56 percent, with digital lending sources driving this growing demand for borrowing.

Fuliza (M-Pesa's mobile money overdraft service) saw a notable penetration into the credit market, with 18% of adults using it in 2021 (@fig-borrprevbylender). While the share of adults using loans from mobile banking services remained stable (9%), the share of adults borrowing from digital lending apps fell from 7% to 2% between 2019 and 2021. The share of adults borrowing from their social networks doubled from 8% to 16%. Overall, however, shopkeeper credit (including both cash loans and purchase of goods on credit) remained the most prevalent form of borrowing (30% of adults used shopkeeper credit in 2021). 


```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-borrprevbytype
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of borrowing by source of loan and gender, 2019 and 2021"

# Indicators used in this figure
indicators <- c("borrower_credit_demand", "lender_agg0_1", "lender_agg0_2", "lender_agg0_3")
groups <- c("fullsample" = "All adults",  "resp_gender_fct" = "Gender")
slicevar <- c("Year" = "year_fct")
 
plot_text <- list(
  title = "Figure 8",
  subtitle = "Just over half of adults over the age of 18 were using a loan at the time of the 2021 survey or had attempted to borrow in the year prior. Two thirds of these borrowers had their demand for credit satisfied by informal options.",
  yaxis = NULL, 
  xaxis = "% of adults (18+)", 
  caption = CAPTION
) 

fig_bar_borrowers_by_type(borrower_data_pool, indicators, slicevar, groups, plot_text)

```


```{r, fig.width = 12, fig.asp = 0.7}
#| label: fig-borrprevbylender
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of borrowing, by lender and gender, 2019 and 2021"

# Indicators used in this figure
indicators <- c("lender_agg3")
groups <- c("fullsample" = "All adults",  "resp_gender_fct" = "Gender")
slicevar <- c("Year" = "year_fct")
 
plot_text <- list(
  title = "Figure 9",
  subtitle = "Types of loans currently used by adults",
  yaxis = NULL, 
  xaxis = "% of adults (18+)", 
  caption = CAPTION
) 

fig_bar_loansused_by_source(borrower_data_pool, indicators, slicevar, groups, plot_text)

```

@fig-borrportfolio the share of borrowers in one of three mutually exclusive groups defined by the most formal loan used by the borrower. In 2021, the most common type of borrower used loans exclusively from informal sources. For 38 percent of borrowers, digital loans are the only formal loan they use, one in five borrowers rely exclusively on digital loans to meet their financing needs.

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-borrportfolio
#| echo: false
#| warning: false
#| fig-cap: "Loan portfolio type, 2021"

# Indicators used in this figure
indicators <- c("borrower_me_formal", "borrower_me_digital", "borrower_me_informal")
groups <- c("fullsample" = "All adults", "resp_gender_fct" = "Gender", "resp_age_group2_fct" = "Age group", "hh_geo2_fct" = "HH residence", "hh_wlth_group" = "HH wealth")
  
plot_text <- list(
  title = "Figure 10",
  subtitle = "In 2021, the most common type of borrower had a loan portfolio comprised exclusively of informal loans.",
  xaxis = NULL,
  yaxis = "% of borrowers by most formal loan currently in use",
  caption = CAPTION
) 

fig_bar_borrowers_by_portfolio(borrower_data, indicators, groups, plot_text)

```

In 2021, users of Fuliza borrowed an average of 7.2 times per year, significantly more frequently than borrowers from other lenders (@fig-nloanspyear). Loans from social networks were the second most frequent source, with an average of 3.4 loans per year, followed by mobile banking (2 loans), and Chama groups (1.9 loans). Other sources, such as fintech apps, private moneylenders, employers or buyers, and SACCOs/MFIs, averaged between 1.1 to 1.6 loans per year. This data underscores the high reliance on Fuliza for frequent, short-term credit needs. 

```{r, fig.width = 12, fig.asp = 0.5}
#| label: fig-nloanspyear
#| echo: false
#| warning: false
#| fig-cap: "Average number of loans taken per year among borrowers, 2021"

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
  
plot_text <- list(
  title = "Figure 11",
   subtitle = "Users of Fuliza borrowed every 1 to 2 months on average in 2021, far more frequently than users of other lenders",
  yaxis = NULL,
  xaxis = "Average number of loans taken in past year",
  caption =  paste(CAPTION, " Notes: This figure only considers cash loans therefore it excludes credit card usage and pruchases of goods from shopkeepers on credit.")
) 

fig_bar_borrowing_freq_by_lender(loans_data, indicators, groups, plot_text)

```

## 3. Why do adults borrow? 

In both 2019 and 2021, the primary and increasingly common reason for borrowing in Kenya was for basic consumption, with the poorest 40% of the population being the most frequent borrowers for this purpose (69% in 2019 and 62% in 2021) (@fig-reasonsforborrowing). The middle 40% and richest 20% also borrowed significantly for basic consumption, though to a slightly lesser extent. Educational expenses were the second most common reason for borrowing, with an increase between 2019 and 2021 evident among all wealth groups. Borrowing for business or farm investment decreased moderately between 2019 and 2021. 


```{r, fig.width = 12, fig.asp = 0.65}
#| label: fig-reasonsforborrowing
#| echo: false
#| warning: false
#| fig-cap: "Borrowers by main reason for taking loans by household wealth, 2019 and 2021"

# Indicators used in this figure
indicators <- "loan_reason_agg"
groups <- c("hh_wlth_group" = "Household wealth")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 12",
  subtitle = "Distribution of loans by main reason for taking loan",
  yaxis = "",
  xaxis = "% of loans",
  caption =  paste(CAPTION)
) 

pal <- c(PALETTES[[names(groups[1])]], PALETTES[[names(groups[2])]])
fig_bar_loan_reasons(loans_data_pool, indicators, slicevar, groups, plot_text, palette = pal)

```

In 2021, borrowers in Kenya cited convenience and ease of obtaining a loan as the primary reasons for considering a lender their most important. Fuliza had the highest percentage of borrowers (60%) valuing convenience, followed by mobile banks (50%) and fintech apps (42%) (@fig-valuedfeatures). Affordability, in terms of low fees and repayments, was another significant factor, especially for SACCOs/MFIs (25%). Ease of use and the ability to make repayments were particularly important for borrowers from informal sources such as social networks (37%), shopkeepers (23%) and employers or buyers (32%), which likely appreciate the flexibility these lenders can afford. Features suited to individual needs, including privacy, were a key consideration for borrowers using fintech apps (34%) and personal or business loans from bank (31%). Trust is rarely cited as a reason people value a lender, with the highest being employer or buyer loans (12%). Overall, the data highlights that while convenience remains the predominant factor in lender importance, affordability and ease of repayments also play crucial roles in shaping borrower preferences.


```{r, fig.width = 12, fig.asp = 0.66}
#| label: fig-valuedfeatures
#| echo: false
#| warning: false
#| fig-cap: "Loan features valued by borrowers, 2021"

# LEFT PANEL
indicators_left <- c("mimp_loan_agg3_")
groups_left <- c("fullsample" = "All borrowers")
plot_text_left <- list(
  title = "Figure 13A",
  subtitle  = "Most important loan\n(% of borrowers)",
  caption =  NULL
) 

# RIGHT PANEL
indicators_right <- c("mimp_reason_1", "mimp_reason_2", "mimp_reason_3", "mimp_reason_4", "mimp_reason_5", "mimp_reason_6", "mimp_reason_7", "mimp_reason_8")
groups_right <- c("mimp_loan_agg3_str" = "Most important loan")
plot_text_right <- list(
  title =  "Figure 13B",
  subtitle = "Reason loan is the most important\n(% of borrowers of lender, row adds to 100%)",
  caption = NULL
) 

fig_comp_borrower_by_mostimplloan(borrower_data, indicators_left, groups_left, indicators_right, groups_right, plot_text_left, plot_text_right)

```

## 4. How many adults have difficulty repaying debt and why?

Between 2019 and 2021, the median loan size among borrowers increased from KSh 3,500 to KSh 4,000 and the percentage of adults with some outstanding debt rose from 40.6% to 49.5%. However,the median outstanding debt declined from KSh 2,700 in 2019 to KSh 2,000 in 2019, consistent with greater use of smaller-value short term loans and less use of larger-value long-term loans. 


```{r, fig.width = 12, fig.asp = 0.65}
#| label: fig-debtstatus
#| echo: false
#| warning: false
#| fig-cap: "Debt and delinquencies by lender, 2019 and 2021"

  indicators <- c("has_recent_loan", "loan_principal_cd", "has_debt", "debt_balance_cd", "debt_balance_income_cd")
  groups <- c("lender_agg3_str" = "Source of loan")
  slicevar <- c("Year" = "year_fct")
  
  notes <- 
    
  plot_text <- list(
  title = "Figure 14",
  subtitle = "Borrowing and debt status by lender, 2019 and 2021",
  yaxis = NULL, 
  xaxis = NULL,  
  caption = CAPTION
) 
  
  fig_tile_debt_overview(respdebt_data_pool, borrower_data_pool, indicators, slicevar, groups, plot_text)

```

In 2021, about 1 in 3 Kenyan adults were either having trouble repaying on time or in full (delinquent) or had to resort to adverse repayment strategies (such as reducing food expenditures, selling assets or borrowing more) (@fig-debtstress). Overall the prevalence of debt stress rose between 2019 to 2021 from 31 to 34%,  rising most sharply among richest 20% of adults. 

In 2021, "Using up all my money for basic needs" (46%) and "Did not plan well enought" (26%) were the two main reasons for failure to repay a loan on time and as agreed. Income declines and poor business performance was also a significant factor, particularly among adults in the highest income quintile. While the data for 2019 is not strictly consistent with 2021 as the reasons were collected for borrowers who reported defaulting on a loan, the patterns suggest the increasing role (from 2019 to 2021) of expenditure pressures forcing borrowers to prioritize basic consumption over debt repayment. 


```{r, fig.width = 12, fig.asp = 1}
#| label: fig-debtstress
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of debt stress and reasons for loan defaults and delinquency, 2019 and 2021"

plot_text <- list(
  title1 = "Figure 15A",
  title2 = "Figure 15B"
) 

slicevar <- c("Year" = "year_fct")
  
fig_comp_debtstress(borrower_data_pool, slicevar, plot_text)

```

