

```{r}
#| include: false

# Importing packaegs, declaring globals
source("R/packages.R")
source("R/utils.R")
source("R/globals.R")
source("R/functions_global.R")
source("R/functions_2021.R")
source("R/functions_2019.R")
source("R/dataviz_functions.R")

##########
# DATA PREP
###########

### 2021 ###
raw_data <- get_raw_data_fromfile(2021, "Anonymized Weighted FinAccess 2021.sav", AGECUTOFF) # Importing FinAccess dataset (2021)
varbook <- gen_varbook_vec(raw_data) # Creating a named vector with all variable names and labels 
modglobal_indicator_reflist(raw_data) # Modifying the gloabl INDICATORS_REFLIST_LVL_LOAN
# Creating analysis datasets: 
borrower_data <- prep_borrower_data(raw_data) # 1 row per adult:
loans_data <- prep_loans_data(raw_data, borrower_data) # 1 row per loan
respdebt_data <- prep_respdebt_data(borrower_data, loans_data, "lender_agg3_str") # 1 row per adult-lender aggregate
respdebt_data_agg1 <- prep_respdebt_data(borrower_data, loans_data, "lender_agg1_str") # 1 row per adult-lender aggregate

### 2019 ###
raw_data_2019 <- get_raw_data_fromfile(2019, "FinAccess2018_new.sav", AGECUTOFF)
varbook_2019 <- gen_varbook_vec(raw_data_2019)
# Creating analysis datasets: 
borrower_data_2019 <- prep_borrower_data(raw_data_2019)
loans_data_2019 <- prep_loans_data(raw_data_2019, borrower_data_2019)
respdebt_data_2019 <- prep_respdebt_data(borrower_data_2019, loans_data_2019, "lender_agg3_str")
respdebt_data_agg1_2019 <- prep_respdebt_data(borrower_data_2019, loans_data_2019, "lender_agg1_str") # 1 row per adult-lender aggregate

# Data pools combining all years
borrower_data_pool <- bind_rows(borrower_data, borrower_data_2019)
loans_data_pool <- bind_rows(loans_data, loans_data_2019)  %>% mutate(fullsample = "All sources")
respdebt_data_pool <- bind_rows(respdebt_data, respdebt_data_2019)
respdebt_data_pool_agg1 <- bind_rows(respdebt_data_agg1, respdebt_data_agg1_2019) 
```


## Summary 

**Credit conditions during COVID-19 tightened substantially**. From a value perspective, the market for credit experienced a sharp contraction in 2021 in concert with the economic slowdown resulting from the direct and indirect impacts of COVID-19. Despite an increase in the number of adults needing credit, total loan disbursements fell. Between 2019 and 2021, the share of adults who had either attempted to borrow or were currently borrowing in the past year rose from 52 to 56%. However, over this period the total *value* of loans disbursed from all lenders fell by 30%. Bank lending in particular pulled back significantly. Total bank lending to adults fell by 50% (KSh 346 billion), and this was almost entirely a reduction in lending to business owners. Lending to employed adults remained steady at around KSh 260 billion in both 2019 and 2021. Other formal financial institutions also reduced lending during this period, but to a lesser degree. While total disbursements from Saccos and MFIs declined by 25 percent, their importance to business owners grew in relative terms: In 2019, the ratio of bank to Sacco/MFI loan disbursements to business owners was 7 to 1 by 2021 the ratio was 1 to 1. With more adults in need of credit and formal institutions less likely to provide financing, more borrowers (especially those among the poorest 40% and richest 20% of households) leaned on social networks to meet liquidity needs. Loans from friends, family members or neighbors rose by Ksh 31 billion (from Ksh 86 to 117 billion) between 2019 and 2021. 

**Digital lending options continue to expand and uncover massive demand for short-term liquidity**. In 2021, nearly 60 percent of the loans disbursed to Kenyan adults were mediated through digital technologies, 37% were mediated through informal or relational agreements and less than 5% were mediated through traditional loan contracts at a financial institution. Fuliza alone accounted for 50% of all loans disbursed in 2021, reflecting rapid adoption of the service which was launched in early 2019. In 2021, Fuliza was used by nearly 1 in 5 adults who typically borrowed Ksh 500, 9 times a year. The data suggest that Fuliza partially displaced the practice of taking goods on credit from shopkeepers (informal buy now pay later), as well as other digital lending options such as loans from mobile banking services and fintech apps. For example, the share of low-value credit (under KSh 2,500) from shopkeepers fell from 34 to 23 percent just as the share of digital loans (including Fuliza) rose from 12 to 24 percent between 2019 and 2021. 

**A rising share of adults are indebted and a significant share show signs of debt stress**. Between 2019 and 2021, the share of adults with some outstanding debt increased by 22 percent, such that in 2021 nearly 50 percent of adults were carrying debt. Over this period, the share of adults reporting that they had to reduce food spending to repay a loan rose from 18 to 22%, with the largest increase among adults in the richest 20% of households (the share reporting having to cut food expenses to repay a loan rose from 15 to 25% from 2019 to 2021). 


## Introduction

The objective of this brief is to use the [FinAccess](https://finaccess.knbs.or.ke) nationally representative survey data to describe the composition and dynamics of borrowing in Kenya over the COVID-19 pandemic period. How many adults were borrowing? Where did they borrow from? How much and why did they borrow? 

It is important to note that this brief brings a 'demand-side' perspective, meaning that the data this report uses to explore the credit market is collected from self-reported responses to questions administered in a survey that is designed to be representative of Kenya's population. Like any source of data, survey data has particular strengths and limitations and the author highlights these upfront to remind readers that for many questions, any single source or piece of data offers only partial or incomplete answers and encourages readers to build a portfolio of evidence for understanding credit in Kenya that includes data from administrative sources and other studies. For example, FSD Kenya, CreditInfo and CIS Kenya recently released a study using credit records provided to the CreditInfo Credit Reference Bureau (CRB) by lenders enabling a supply-side perspective on the landscape of formal credit^[FSD Kenya, CreditInfo and CIS Kenya. (2024). "Kenya's Credit Market Landscape: Demand-side analysis of credit records held by CreditInfo CRB"]. 

One objective of the analyses herein is to estimate the size of the market for credit among households. However, estimates of the volume and value of loans disbursed by financial service providers from FinAccess compared to figures published by financial service providers, regulators or supervisors in annual reports or financial statements will not necessarily align with these estimates. There are several reasons that measures of loan disbursements by volume or value can be misaligned between demand- supply-side sources. A few reasons are outlined below and an illustrative example comparing the demand- and supply-side estimates of the value of annual loan disbursements from M-Shwari, Fuliza and Commercial Banks is provided thereafter. 

* **Universe of inference**: Given that FinAccess is a household survey that captures the adoption and use of financial services at the level of individuals, it will not capture the borrowing behavior of large formal firms or other institutional entities and may only partially capture the borrowing behavior of smaller, domestic, firms and owner-operated businesses whose owners would be included in the survey. 
* **Survey sampling bias**: While the FinAccess survey is designed to be nationally representative using the latest (2019) Census list of households as a sampling frame, surveys are known to miss individuals at the extreme upper-end of the income distribution, a problem which has been referred to as the "Missing rich" ^[See for example Lustig, Nora (2019) "The Missing Rich in household surveys: Causes and Correction Approaches" CEQ Working paper 75.]. To the extent that borrowing from certain types of providers (e.g. banks) or credit instruments (e.g. mortgages) is concentrated at the upper-tail of the income distribution, a survey like FinAccess may under-count the absolute number of borrowers of services that are adopted more widely or intensively by members of the wealthiest households.  
* **Survey measurement error**: In addition to statistical sampling error which arises due to  the variation in estimates of a population parameter from repeated samples, responses to questions in surveys can also be prone to errors. For example, to measure borrowing activity, FinAccess asks respondents to recall whether they have taken a loan from a particular provider, how much was borrowed in the most recent case and how many loans were taken in total from that provider over the past year. The details of a large personal bank loan or mortgage taken one or two months ago are easier to remember then the details and total number of smaller loans taken from a digital lender or shopkeeper over the past year.
* **Reference-period**: The reference period for measures of the credit market obtained from the FinAccess survey correspond to the 12-month period prior to the date of data collection. For example, for the 2021 FinAccess survey the reference period over which borrowing activity is measured is June-September 2020 through June-September 2021. Data supplied in annual reports from providers or supervisors (such as the Central Bank) is usually aligned with the calender or fiscal year (which may vary from provider to provider). 

Measures of the market for credit from FinAccess are not a substitute for measures obtained from supply-side sources. However, they are complementary and offer a view of the market that supply side data sources cannot provide. For example, publicly available supply-side figures published in annual reports or financial statements rarely disaggregate indicators across important socio-economic and demographic characteristics, such as gender, income, livelihood, geographic location and age. Demand-side data provides a comprehensive view of borrowing behavior that spans use of loans from both informal and formal sources of credit. The former continues to be an important source of liquidity in Kenya so any analysis of credit markets that omits borrowing from informal lenders will be incomplete in this context. In addition, surveys provide data that can better help contextualize the demand for lending, such as the reasons individuals are borrowing and whether borrowers are having difficulty repaying. 

### Reconciling differences in demand and supply-side estimate of credit flows
This report uses several questions from FinAccess to estimate the annual market for loans by volume and value for a range of credit providers. The figure below shows FinAccess estimates for the total value of loan disbursements from Fuliza, M-Shwari and Commercial Banks alongside those reported by Safaricom in its annual sustainability report. There is a very large difference in the value of yearly borrowing from Fuliza in 2021 (the first year Fuliza loans were captured in Finaccess) and a widening gap in the value of commercial bank loans to the household sector (as reported by the Central Bank of Kenya) with FinAccess. FinAccess measured a total of KSh 53 billion in Fuliza loans disbursed between September 2020 through September 2021. By March 30th, 2021 Safaricom reported KSh 351 billion in loans, over 6 times the value reported in FinAccess. The differences are much smaller with M-Shwari. With regards to the annual value of Commercial bank lending, in 2019, FinAccess captured a total of KSh 768 Billion in lending compared to a total of KSh 661 billion in gross loans to the household sector reported by the Central Bank of Kenya (CBK). In 2021, the difference widened substantially, with total commercial bank lending to households reported by CBK exceeding total lending in FinAccess by over Ksh 400 billion. Further research is needed to better understand the sources of the discrepancy between supply and demand-side estimates of loan disbursements from Commercial banks that emerged in 2021. 

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-fuliza_favsaf
#| echo: false
#| warning: false
#| fig-cap: "Digital credit market value indicators: Supply vs. Demand-side measurements"

# Supply side 

fuliza <- tibble(
  "year" = c(2019.25, 2020.25, 2021.25, 2022.25), 
  "product" = rep("Fuliza", 4), 
  "customers_m" = NA,
  "total_disbursed_volume_m" = c(46.4, 392.9, 787.1, 1456),
  "total_disbursed_value_b" = c(29, 245, 351, 502.6)
)

mshwari <- tibble(
  "year" = c(2018.25, 2019.25, 2020.25, 2021.25, 2022.25), 
  "product" = rep("M-Shwari*", 5), 
  "customers_m" = c(3.26, 3.99, 4.66, 3.98, 4.67), 
  "total_disbursed_volume_m" = rep(NA, 5), 
  "total_disbursed_value_b" = c(83.3, 97.5, 129.6, 94.5, 86.1)
)

mshwari <- tibble(
  "year" = c(2018.25, 2019.25, 2020.25, 2021.25, 2022.25), 
  "product" = rep("M-Shwari*", 5), 
  "customers_m" = c(3.26, 3.99, 4.66, 3.98, 4.67), 
  "total_disbursed_volume_m" = rep(NA, 5), 
  "total_disbursed_value_b" = c(83.3, 97.5, 129.6, 94.5, 86.1)
)

cbk <- read_csv("data/cbk_loansbysector.csv") %>% 
  mutate(
    sector = str_trim(sector), 
    personal = ifelse(sector == "Personal/Household", "Personal/Household", "Other")
  ) %>% 
  group_by(year, personal) %>% 
  summarise(
    total_disbursed_value_b = sum(gross_loans)*1e6/1e9
  ) %>% 
  mutate(
    year = year + 0.9, 
    product = "Bank loans**", 
    source = "Annual report",
    source2 = "Central Bank of Kenya"
  ) %>% filter(personal == "Personal/Household")

supplyside <- bind_rows(fuliza, mshwari) %>% mutate(source = "Annual report", source2 = "Safaricom Results Booklet")

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
slicevar <- c("Year" = "year_fct")

#get_indicator_total(loans_data, indicators, groups)

demandside <- loans_by_slice(loans_data_pool, indicators, slicevar, groups) %>% 
  ungroup() %>% 
  filter(group_cat_val %in% c("Bank: Mobile", "Mobile money operator: Fuliza")) %>%
  mutate(year_c = ifelse(year_fct == "2021", 2021.7, 2018.9)) %>% 
  mutate(product = ifelse(group_cat_val == "Mobile money operator: Fuliza", "Fuliza", "M-Shwari*")) %>% 
  mutate(total = total/1e9, source = "FinAccess") %>% 
  select(year = year_c, product, total_disbursed_value_b = total, source)

demandside_banks <- loans_by_slice(loans_data_pool, indicators, slicevar, groups) %>% 
  ungroup() %>% 
  filter(group_cat_val %in% c("Bank: Mobile", "Bank: Personal or business", "Bank: Overdraft or credit card")) %>% 
  group_by(year_fct) %>% 
  summarize(
    total_disbursed_value_b = sum(total)/1e9
  ) %>% 
  ungroup() %>% 
  mutate(year = ifelse(year_fct == "2021", 2021.7, 2018.9), 
         product = "Bank loans**", 
         source = "FinAccess") 
  
  
chart_df <- bind_rows(supplyside, demandside, cbk, demandside_banks) %>% mutate(group = paste(product, source, sep = "-")) %>% 
  mutate(
    product = factor(product, levels = c("Fuliza", "M-Shwari*", "Bank loans**"))
  )

ggplot(data = chart_df, 
       aes(x = year, 
           y = total_disbursed_value_b, 
           group = group, 
           color = source)) + 
  facet_wrap(~ product, nrow = 1, scales = "fixed") + 
  geom_line(size = 2.25) + 
  geom_point(size = 3.75, shape = 21, fill = "white") +
  geom_text(aes(label = round(total_disbursed_value_b, 0)), vjust = -0.6, show.legend = FALSE) +
  scale_y_continuous(limits = c(0, 1100)) + 
  scale_color_manual(values = c("FinAccess" = "#F90093", "Annual report" = "#610F7F")) +
  guides(color = guide_legend(title = NULL)) + 
  labs(title = "Figure 1", 
         subtitle = str_wrap("Total annual value of loan disbursements (KSh billions), supply and demand-side estimates", 60),
         y = "KSh billions", 
         x = NULL, 
       caption = str_wrap("Notes: For comparability, estimates of the total value of disbursements have been positioned in continuous time at the end-point of the measurement period that they represent. For example, Safaricom reports figures corresponding to the cumulative value of loans disbursed during their fiscal year. Since FY2021 spans April 1st, 2020 through March 30th, 2021, figures corresponding to FY2021 are positioned at 2021.25. Estimates from FinAccess are derived from a question asking about total loans taken from specific providers during the past 12 months, so the end-point of this period is the time of data collection. For the 2021 FinAccess survey, this corresponds to August, so the estimate is positioned at 2021.7. *FinAccess derived estimates for M-Shwari are not strictly comparable with Safaricom published figures for M-Shwari because FinAccess collects data on 'Loans from mobile banking' which includes M-Shwari as well as other mobile banking loan providers such as KCB M-Pesa, as such estimates from FinAccess for M-Shwari specifically are biased upwards. ** Supply-side data for bank loans correspond to Personal/Household gross loans from the Bank Supervision Annual reports published by the Central Bank of Kenya", 150)) + 
  theme_custom(scale_f = 1.2) + 
  theme(legend.position = "bottom", legend.direction = "horizontal", strip.text = element_text(face = "bold"), axis.text = element_text(face = "plain"))


```

What might account for the large difference seen with Fuliza? To identify the potential causes of the discrepancy, it is helpful to unpack how estimates of the value of loans disbursed on an annual basis are computed from FinAccess (for borrowers of a specific type of loan). The equation below highlights the key components:

$$\sum_{n=1}^{B} N_{loanspastyear} * P_{recentloan} $$ 

where $B=$ Total number of borrowers,  $N_{loanspastyear}=$ Total number of loans taken in the past year, $P_{recentloan}=$ Amount borrowed (for most recent loan)$. In computing the total value of borrowing for a specific borrower, the value of the borrower's most recent loan is assumed to apply for all previous loans taken in the year. For Fuliza, the value of the components of total annual loan disbursements obtained from FinAccess and Safaricom annual reports are provided in the table below. The median size of Fuliza loans from FinAccess (KSh 500) closely matches Safaricom's 'global' Fuliza transaction size obtained by dividing the total annual disbursements (KSh 503 billion) by the total number of annual transactions (787.1 million). Where differences arise between FinAccess and Safaricom is with respect to unique borrowers and annual transactions per borrower. FinAccess captured an estimated 1 million fewer unique Fuliza borrowers than what Safaricom reported. However, the main reason FinAccess underestimates the total value of annual loans disbursed (compared to supply-side figures) is that it measures a much lower intensity of loan-taking per borrower than implied by Safaricom's own numbers: 9.3 loans per borrower per year (one loan every 39 days) versus 123 loans per borrower per year (one loan every 3 days). 

```{r, fig.width = 12, fig.asp = 0.5}
#| label: fig-fuliza_favsaf_table
#| echo: false
#| warning: false
#| fig-cap: "Fuliza loan adoption and usage indicators: FinAccess estimates v Safaricom published figures"

fuliza_demand <- tibble(
  "Source" = c("FinAccess", "Safaricom"), 
  "Year" = c("Sep 2020 - Sep 2021", "April 2020 - March 2021"), 
  "Percent of adult (18+) population using Fuliza" =  c("18.3%", "-"), 
  "Adult (18+) population represented by FinAccess (millions)" = c("27.29", "-"), 
  "Unique borrowers (18+, millions)" = c("4.99", "5.9"), 
  "Number of transactions (millions)" = c("52.8", "787.1"),
  "Average number of loans taken per borrower" = c("9.3", "123"), 
  "Average size of loan" = c("KSh 1,078", "KSh 446"), 
  "Median size of loan" = c("KSh 500", "-") 
)

t(fuliza_demand) %>% kbl() %>%
  kable_styling(bootstrap_options = "striped")

```


## 1. How large is the market for loans in Kenya? 

A total of KSh 1,028 billion was disbursed by lenders in 2021 (@fig-marketbyval). Banks were the largest source, disbursing KSh 345 billion (34%), followed by Sacco/MFIs at KSh 264 billion (26%). Digital loans, including mobile banking, Fuliza and lending apps, accounted for a combined value of KSh 120 billion (11%), while informal lenders including social network, chama and shopkeeper loans accounted for KSh 220 billion (22%)^[FinAccess does not capture the total number of times per year people use shopkeeper 'goods on credit' (informal buy now pay later) agreements. Given the prevalence of this form of borrowing in Kenya, the total annual value of shopkeeper credit laons is imputed by assuming that the total annual number of shopkeeper credit loans for each user of this type of loan, is equivalent to the median number of loans borrowers used from any informal source (social networks, chama, shopkeeper cash loans) where we do have respondent answers on frequency of annual borrowing. In 2020 this was 1 per year, in 2021 this was 2 per year.]. The market for loans from a volume perspective, is the mirror image of the value perspective. Lending mediated through in-person agreements at formal financial institutions, while accounting for less then 5% of the volume, accounts for over two thirds of the total value of lending. Digital loans, while accounting for two-thirds of the volume accounts for 12% of the total value of lending.  

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyval
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by value, 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
  
plot_text <- list(
  title = "Figure 2. \n Total yearly value of loans disbursed by lender (2021)",
  subtitle = "",
  caption = CAPTION
) 

#get_indicator_total(loans_data, indicators, groups)

fig_tree_loans_by_value(loans_data, indicators, groups, plot_text)

```

An estimated 107 million loans in Kenya were taken by borrowers in 2021. Nearly half of these loans (49%) were mobile money overdrafts using M-PESAâ€™s Fuliza service, and a further 9 percent were digital loans from mobile banking services (8%) or fintech apps (1%) (@fig-marketbyvol). Social networks (friends, family and neihbors) accounted for 14% of loans disbursed, while other informal sources such as Chamas (voluntary savings or investment groups), shopkeepers, employers or buyers collectively contributed around 24% of the total. The big picture that the data highlights is that nearly 60% of the demand for loans (by volume) in Kenya in 2021 was mediated through digital technologies, 37% was mediated through informal or relational agreements and less than 5% was mediated through traditional loan contracts at financial institutions.

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyvol
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by volume"

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg3_str" = "Lender")
  
plot_text <- list(
  title = "Figure 3. \n Total yearly volume of loans disbursed by lender (2021)",
  subtitle = "",
  caption = CAPTION
) 

# Total volume of loans: 
#get_indicator_total(loans_data, indicators, groups)

fig_tree_loans_by_volume(loans_data, indicators, groups, plot_text)

```

Compared to 2019, the total annual value of loans disbursed in 2021 fell by 30% (from KSh 1,452 to KSh 1,028 billion) (@fig-marketbyyear). Much of this decline is attributable to Bank lending which fell by over KSh 300 billion (from KSh 691 to 345 billion) and lending from Saccos or MFIs which fell by KSh 92 billion. Loans from social networks partially offset this decline, which increased from KSh 86 billion in 2019 to KSh 117 billion in 2021. 

On the other hand, the total volume of loans disbursed in Kenya increased by 16%, from 92 to 107 million. Loans from formal institutions remained flat, with digital loans remaining the dominant form of borrowing, though their share declined as the use of social networks for borrowing (broadly defined to include employers in addition to friends and family) and shopkeeper credit increased significantly, rising from 23 million in 2019 to 37 million in 2021. The volume of traditional loans from financial institutions (Banks, Saccos, MFIs) fell by nearly 1 million. 

While both the total number of unique borrowers^[Unique borrowers are defiend as those who reported taking a loan from a specific provider in the past year and provided details on their most recent loan] increased slightly from 14.1 to 14.7 million between 2019 and 2021, and the average number of loans used per borrower per year (from all credit providers) increased slightly (from 6.5 to 7.3), the average size of each loan secured by borrowers fell substantially, from KSh 42,400 to 25,312 (the median loan size remained at Ksh 1,500 in 2019 and 2021). The decline in the overall market for credit between 2019 and 2021 is a result of a change in the composition of borrowing away from longer-term, larger-value traditional financial institution loans (such as personal or business loans from Banks, Saccos and MFIs), towards lower-value, short-term digital and informal loans. 

```{r, fig.width = 12, fig.asp = 0.5}
#| label: fig-marketbyyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by value and volume, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 4A",
  subtitle ="Total yearly value of loans (KSh billions) disbursed by lender and year",
  caption = NULL
) 

plot_label <- list(
  type = "valueonly", 
  threshold = c("ind_totalborrowed_pastyear_bylender" = 5e9, "ind_nloans_pastyear_bylender" = 1.75e6), 
  hjust =  c("ind_totalborrowed_pastyear_bylender" = 0.5, "ind_nloans_pastyear_bylender" = 0.5),  
  vjust =  c("ind_totalborrowed_pastyear_bylender" = -0.4, "ind_nloans_pastyear_bylender" = -0.4),  
  ymax = 1500e9
)

#get_indicator_total(loans_data, indicators, groups)

p1 <- fig_bar_loans_by_slice(loans_data_pool, indicators, slicevar, facetvar = NULL, groups, plot_text, plot_label, bar_width = 0.4, reverse_legend = FALSE)

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  subtitle = "Total yearly volume of loans (millions) disbursed by lender and year",
  title = "Figure 4B",
  caption = NULL
) 

plot_label[["ymax"]] <- 92e6

# Total volume of loans: 
#get_indicator_total(loans_data, indicators, groups)

p2 <- fig_bar_loans_by_slice(loans_data_pool, indicators, slicevar, facetvar = NULL, groups, plot_text, plot_label, bar_width = 0.4, reverse_legend = FALSE)

# Combining plots

p1 + p2 + plot_layout(guides = 'collect')  &
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      plot.caption=element_text(hjust=0, color="grey40", size=11)
    )

```

```{r, fig.width = 12, fig.asp = 0.45}
#| label: fig-loanmetrics
#| echo: false
#| warning: false
#| fig-cap: "Unique borrowers, size of loans and loans taken per year, 2019 and 2021"

levels = c("All sources", "Bank",  "Sacco/MFI", "Digital", "Chama", "Social network", "Shopkeeper", "Government", "Other") 

# Total number of borrowers
indicators <- c("has_recent_loan")
groups <- c("lender_agg1_str" = "Source of loan")
slicevar <- c("Year" = "year_fct")
  
plot_text <- list(
  title = "Figure 5A",
   subtitle = "Total borrowers (m)",
  yaxis = NULL,
  xaxis = "Adults (N)",
  caption =  NULL
) 

p1 <- fig_bar_borrowers_by_lender(respdebt_data_pool_agg1, indicators, slicevar, groups, plot_text, value = "total", group_cat_levels = levels)


# Indicators used in this figure
indicators <- c("loan_principal")
groups <- c("fullsample" = "All sources", "lender_agg1_str" = "Source of loan")
slicevar <- c("Year" = "year_fct")
  
plot_text <- list(
  title = "Figure 5B",
   subtitle = "Average size of loan (KSh)",
  yaxis = NULL,
  xaxis = "Loan principal (KSh)",
  caption =  NULL
) 

p2 <- fig_bar_loansize_by_lender(loans_data_pool, indicators, slicevar, groups, plot_text, value = "mean", group_cat_levels = levels) + theme(axis.text.y = element_blank())


# Indicators used in this figure
indicators <- c("nloans_pastyear_cd")
groups <- c("lender_agg1_str" = "Source of loan")
slicevar <- c("Year" = "year_fct")
  
plot_text <- list(
  title = "Figure 5C",
   subtitle = "Loans taken per year per borrower (average)",
  yaxis = NULL,
  xaxis = "Loans (N)",
  caption =  NULL
) 

p3 <- fig_bar_loanfreq_by_lender(respdebt_data_pool_agg1, indicators, slicevar, groups, plot_text, value = "mean", group_cat_levels = levels) + theme(axis.text.y = element_blank())

(p1 + p2 + p3) + plot_layout(guides = 'collect') & 
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      legend.position = "bottom", 
      legend.direction = "horizontal", 
      plot.caption=element_text(hjust=0, color="grey40", size=11), 
      axis.text = element_text(face = "plain")
    )


```


@fig-marketbysizesource shows the distribution of the most recent loans used by borrowers by the amount borrowed (the loan principal) and the source of the loan for 2019 and 2021. A dominant majority of loans (nearly 60%) were less than KSh 2,500 in both 2019 and 2021, just over 20 percent were between KSh 2,500 and KSh 10,000 and 15 percent were between KSh 10,000 and KSh 50,000. Shopkeeper loans and digital loans dominate the market for small loans while formal, non-digital loans from Banks and Saccos dominate the market for large loans. Between 2019 and 2021, the distribution of recent loans shifted moderately to higher frequency smaller loans as the share of loans greater than KSh 10,000 fell. In 2021, Fuliza accounted for nearly 1 in 3 of the most recent loans used that were less than KSh 2,500. This data suggests that Fuliza is beginning to crowd out shopkeeper credit whose share of small loans (< KSh 2,500) fell from 34% to 23% between 2019 and 2021. 

```{r, fig.width = 12, fig.asp = 0.5}
#| label: fig-marketbysizesource
#| echo: false
#| warning: false
#| fig-cap: "Loans by size and source, 2019 and 2021"

# Indicators used in this figure
indicators <- c("loan_principal_cat")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 6",
  subtitle = "Distribution of most recent loans by size and source (%)",
  xaxis = "Loan principal (KES)", 
  yaxis= NULL, 
  caption = CAPTION
) 

fig_bar_loans_by_size_and_source(loans_data_pool, indicators, slicevar, groups, plot_text) + theme(strip.text.x = element_text(face = "bold"), axis.text = element_text(face = "plain"))

```

@fig-marketbygenderyear through @fig-marketbylocyear show the value and volume of annual lending to different segments of the market, providing a perspective on borrowing by gender, household wealth^[Household wealth is proxied using data on the quality of housing conditions and household ownership of physical assets], livelihood and household location. 

Between 2019 and 2021, the total value of loans disbursed to men declined by nearly 40 percent as a result of lower disbursements from formal financial institutions and digital lenders. On the other hand total disbursements to women stayed flat, as aggregate disbursements from Saccos, MFIs, chamas, social networks and shopkeepers offset declines in disbursements from banks among women. 

@fig-marketbywealthyear shows a substantial decline in credit flowing to borrowers in households ranking in the top 20% of the wealth distribution. The total value of Bank, Sacco and digital loans channeled to these wealthier borrowers collapsed by around 50% (from KSh 909 to Ksh 471 billion) between 2019 and 2021, while loans from friends and family rose by 50% (from KSh 33 to Ksh 51 billion). In contrast, the total value of loans disbursed to borrowers in households ranking the bottom 40% of the wealth distribution almost doubled, rising from KSh 69 in 2019 to KSh 113 billion in 2021.

@fig-marketbyliveyear reveals lending to business owners fell by 70%, from KSh 584 to KSh 192 billion between 2019 and 2021. This decline was overwhelmingly a result of bank lending to business owners falling by 90 percent. Another factor contributes to the lower value of lending to businesses: the share of adults deriving most of their income from their business fell from 17 to 14% between 2019 and 2021 (among the wealthiest 20% of households, the share fell from 30 to 22%). Total annual loan disbursements to employed adults declined by 17 percent, primarily as a result of lower Sacco or MFI lending to this group. Bank lending to the employed increased slightly from KSh 258 to 262. 


```{r, fig.width = 12, fig.asp = 0.5}
#| label: fig-marketbygenderyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by gender, 2019 and 2021"

# Indicators used in this figure
#indicators <- c("ind_totalborrowed_pastyear_bylender", "ind_nloans_pastyear_bylender")
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Gender" = "resp_gender_fct")
facetvar <- c("indicator_name")

plot_text <- list(
  subtitle = "Total yearly value of loans disbursed by lender (KSh bilions)",
  title = "Figure 7A",
  caption = NULL
) 

plot_label <- list(
  type = "valueonly", 
  threshold = c("ind_totalborrowed_pastyear_bylender" = 40e9, "ind_nloans_pastyear_bylender" = 1.75e6), 
  hjust =  c("ind_totalborrowed_pastyear_bylender" = -0.2, "ind_nloans_pastyear_bylender" = -0.2),  
  vjust =  c("ind_totalborrowed_pastyear_bylender" = 0.5, "ind_nloans_pastyear_bylender" = 0.5),  
  ymax = 1500e9
)

p1 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.6, flip_coords = TRUE, show_legend = FALSE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

# Indicators used in this figure
#indicators <- c("ind_totalborrowed_pastyear_bylender", "ind_nloans_pastyear_bylender")
indicators <- c("ind_nloans_pastyear_bylender")

plot_text <- list(
  subtitle = "Total yearly volume of loans disbursed by lender (millions)",
  title = "Figure 7B",
  caption = NULL
) 

plot_label[["ymax"]] <- 70e6

p2 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.6, flip_coords = TRUE, show_legend = TRUE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

(p1 / p2)  &
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      plot.caption=element_text(hjust=0, color="grey40", size=11)
    )

```

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbywealthyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by household wealth, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Household wealth" = "hh_wlth_group")
facetvar <- c("indicator_name")

plot_text <- list(
  subtitle = "Total yearly value of loans disbursed by lender (KSh bilions)",
  title = "Figure 8A",
  caption = NULL
) 

plot_label <- list(
  type = "valueonly", 
  threshold = c("ind_totalborrowed_pastyear_bylender" = 40e9, "ind_nloans_pastyear_bylender" = 1.75e6), 
  hjust =  c("ind_totalborrowed_pastyear_bylender" = -0.2, "ind_nloans_pastyear_bylender" = -0.2),  
  vjust =  c("ind_totalborrowed_pastyear_bylender" = 0.5, "ind_nloans_pastyear_bylender" = 0.5),  
  ymax = 1300e9
)

p1 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = FALSE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

# Indicators used in this figure
#indicators <- c("ind_totalborrowed_pastyear_bylender", "ind_nloans_pastyear_bylender")
indicators <- c("ind_nloans_pastyear_bylender")

plot_text <- list(
  subtitle = "Total yearly volume of loans disbursed by lender (millions)",
  title = "Figure 8B",
  caption = NULL
) 

plot_label[["ymax"]] <- 55e6

p2 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = TRUE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

(p1 / p2)  &
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      plot.caption=element_text(hjust=0, color="grey40", size=11)
    )


```

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbyliveyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by livelihood, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
slicevar <- c("Main livelihood" = "resp_live_group_fct")
facetvar <- c("indicator_name")

plot_text <- list(
  subtitle = "Total yearly value of loans disbursed by lender (KSh bilions)",
  title = "Figure 9A",
  caption = NULL
) 

plot_label <- list(
  type = "valueonly", 
  threshold = c("ind_totalborrowed_pastyear_bylender" = 30e9, "ind_nloans_pastyear_bylender" = 1.75e6), 
  hjust =  c("ind_totalborrowed_pastyear_bylender" = -0.2, "ind_nloans_pastyear_bylender" = -0.2),  
  vjust =  c("ind_totalborrowed_pastyear_bylender" = 0.5, "ind_nloans_pastyear_bylender" = 0.5),  
  ymax = 700e9
)

p1 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = FALSE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")

plot_text <- list(
  subtitle = "Total yearly volume of loans disbursed by lender (millions)",
  title = "Figure 9B",
  caption = NULL
) 

plot_label[["ymax"]] <- 50e6

p2 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = TRUE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

(p1 / p2)  &
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      plot.caption=element_text(hjust=0, color="grey40", size=11)
    )

```

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-marketbylocyear
#| echo: false
#| warning: false
#| fig-cap: "The market for loans by motivation for borrowing, 2019 and 2021"

# Indicators used in this figure
indicators <- c("ind_totalborrowed_pastyear_bylender")
groups <- c("lender_agg1_str" = "Lender")
#slicevar <- c("Main reason for borrowing" = "loan_reason_agg_str")
slicevar <- c("Household location" = "hh_geo2_fct")
facetvar <- c("indicator_name")

plot_text <- list(
  subtitle = "Total yearly value of loans disbursed by lender (KSh bilions)",
  title = "Figure 10A",
  caption = NULL
) 

plot_label <- list(
  type = "valueonly", 
  threshold = c("ind_totalborrowed_pastyear_bylender" = 30e9, "ind_nloans_pastyear_bylender" = 1.75e6), 
  hjust =  c("ind_totalborrowed_pastyear_bylender" = -0.2, "ind_nloans_pastyear_bylender" = -0.2),  
  vjust =  c("ind_totalborrowed_pastyear_bylender" = 0.5, "ind_nloans_pastyear_bylender" = 0.5),  
  ymax = 900e9
)

p1 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = FALSE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

# Indicators used in this figure
indicators <- c("ind_nloans_pastyear_bylender")

plot_text <- list(
  subtitle = "Total yearly volume of loans disbursed by lender (millions)",
  title = "Figure 10B",
  caption = NULL
) 

plot_label[["ymax"]] <- 70e6

p2 <- fig_bar_loans_by_slice_year_v2(loans_data_pool, indicators, slicevar, facetvar, groups, plot_text, plot_label, bar_width = 0.7, flip_coords = TRUE, show_legend = TRUE, legend_pos = "bottom")  + theme(strip.text.y.left = element_blank())

(p1 / p2)  &
    plot_annotation(
      caption =  CAPTION
  ) & 
    theme(
      plot.caption=element_text(hjust=0, color="grey40", size=11)
    )

```

## 2. How prevalent are different forms of borrowing among adults?

In 2021, 56% of Kenyan adults were either currently borrowing or had attempted to borrow in the past year, with similar proportions for both men and women  (@fig-borrprevbytype). Two-thirds of these borrowers used informal options such as social networks, chamas, private moneylenders, employers, or buyers to address their credit needs.  Forty percent of this demand was satisfied by digital options, such as mobile banking, apps or Fuliza and 16 percent was met by traditional (non-digital) loans originating from financial institutions (commercial banks, SACCOs or MFIs). Men are over 30 percent more likely than women to borrow from formal financial institutions or use digital loans, but women are 26 percent more likely than men to use informal credit sources. Between 2019 and 2021, the prevalence of bororwing increased from 52 to 56 percent, with digital lending sources driving this growing demand for borrowing. Borrowing prevalence increased primarily in the lower threee quintiles of the income distribution, and the prevalence of borrowing from digital sources increased across the income distribution (@borrprevbytype_gender_income).

Fuliza (M-Pesa's mobile money overdraft service) saw a notable penetration into the credit market, with 18% of adults using it in 2021 (@fig-borrprevbylender). While the share of adults using loans from mobile banking services remained stable (9%), the share of adults borrowing from digital lending apps fell from 7% to 2% between 2019 and 2021. The share of adults borrowing from their social networks doubled from 8% to 16%. Overall, however, shopkeeper credit (including both cash loans and purchase of goods on credit) remained the most prevalent form of borrowing (30% of adults used shopkeeper credit in 2021). 


```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-borrprevbytype
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of borrowing by source of loan and gender, 2019 and 2021"

# Indicators used in this figure
indicators <- c("borrower_credit_demand", "lender_agg0_1", "lender_agg0_2", "lender_agg0_3")
groups <- c("fullsample" = "All adults",  "resp_gender_fct" = "Gender")
slicevar <- c("Year" = "year_fct")
 
plot_text <- list(
  title = "Figure 11",
  subtitle = "Prevalence of borrowing by source of loan and gender, 2019 and 2021",
  yaxis = NULL, 
  xaxis = "% of adults (18+)", 
  caption = CAPTION
) 

fig_bar_borrowers_by_type(borrower_data_pool, indicators, slicevar, groups, plot_text)

```

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-borrprevbytype_gender_income
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of borrowing by source of loan, gender and household wealth quintile, 2019 and 2021"

# Indicators used in this figure
indicators <- c("borrower_any_status", "lender_agg0_1", "lender_agg0_2", "lender_agg0_3")
groups <- c("resp_income_quintile" = "Personal monthly income")
slicevar <- c("Gender" = "resp_gender_fct")
 
plot_text <- list(
  title = "Figure 12",
  subtitle = "Prevalence of borrowing by source of loan, gender and household wealth quintile",
  yaxis = NULL, 
  xaxis = "Personal monthly income (quintile)", 
  caption = CAPTION
) 

fig_bar_borrowers_by_type_inc_bd(borrower_data_pool, indicators, slicevar, groups, plot_text) + theme(strip.text.x = element_text(face = "plain"), strip.text.y.left = element_text(face = "bold", angle = 0), strip.placement = "outside", axis.text = element_text(face = "plain"))

```


```{r, fig.width = 12, fig.asp = 0.7}
#| label: fig-borrprevbylender
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of borrowing, by lender and gender, 2019 and 2021"

# Indicators used in this figure
indicators <- c("lender_agg3")
groups <- c("fullsample" = "All adults",  "resp_gender_fct" = "Gender")
slicevar <- c("Year" = "year_fct")
 
plot_text <- list(
  title = "Figure 13",
  subtitle = "Types of loans currently used by adults",
  yaxis = NULL, 
  xaxis = "% of adults (18+)", 
  caption = CAPTION
) 

fig_bar_loansused_by_source(borrower_data_pool, indicators, slicevar, groups, plot_text) + theme(strip.text.x = element_text(face = "bold"))

```

@fig-borrportfolio shows the share of borrowers in one of three mutually exclusive groups defined by the most formal loan used. In 2021, the most common type of borrower used loans exclusively from informal sources. For 38 percent of borrowers, digital loans are the only formal loan they use, one in five borrowers rely exclusively on digital loans to meet their financing needs.

```{r, fig.width = 12, fig.asp = 0.6}
#| label: fig-borrportfolio
#| echo: false
#| warning: false
#| fig-cap: "Loan portfolio type, 2021"

# Indicators used in this figure
indicators <- c("borrower_me_formal", "borrower_me_digital", "borrower_me_informal")
groups <- c("fullsample" = "All adults", "resp_gender_fct" = "Gender", "resp_age_group2_fct" = "Age group", "hh_geo2_fct" = "HH residence", "hh_wlth_group" = "HH wealth")
  
plot_text <- list(
  title = "Figure 14",
  subtitle = "In 2021, the most common type of borrower had a loan portfolio comprised exclusively of informal loans.",
  xaxis = NULL,
  yaxis = "% of borrowers by most formal loan currently in use",
  caption = CAPTION
) 

fig_bar_borrowers_by_portfolio(borrower_data, indicators, groups, plot_text)

```


## 3. Why do adults borrow? 

In both 2019 and 2021, the primary reason for borrowing in Kenya was for basic consumption, with the poorest 40% of the population being the most frequent borrowers for this purpose (69% in 2019 and 62% in 2021) (@fig-reasonsforborrowing). The middle 40% and richest 20% also borrowed significantly for basic consumption, though to a slightly lesser extent. Educational expenses were the second most common reason for borrowing, with an increase between 2019 and 2021 evident among all wealth groups. Borrowing for business or farm investment decreased moderately between 2019 and 2021. 

```{r, fig.width = 12, fig.asp = 0.65}
#| label: fig-reasonsforborrowing
#| echo: false
#| warning: false
#| fig-cap: "Borrowers by main reason for taking loans by household wealth, 2019 and 2021"

# Indicators used in this figure
indicators <- "loan_reason_agg"
groups <- c("hh_wlth_group" = "Household wealth")
slicevar <- c("Year" = "year_fct")

plot_text <- list(
  title = "Figure 16",
  subtitle = "Distribution of loans by main reason for taking loan",
  yaxis = "",
  xaxis = "% of loans",
  caption =  paste(CAPTION)
) 

pal <- c(PALETTES[[names(groups[1])]], PALETTES[[names(groups[2])]])
fig_bar_loan_reasons(loans_data_pool, indicators, slicevar, groups, plot_text, palette = pal) + theme(strip.text.x = element_text(face = "bold"))

```

```{r, fig.width = 12, fig.asp = 0.65}
#| label: fig-reasonsforborrowing_bygender
#| echo: false
#| warning: false
#| fig-cap: "Borrowers by main reason for taking loans by household wealth, 2019 and 2021"

# Indicators used in this figure
indicators <- "loan_reason_agg"
groups <- c("hh_wlth_group" = "Household wealth")
slicevar <- c("Gender" = "resp_gender_fct")

plot_text <- list(
  title = "Figure 17",
  subtitle = "Distribution of loans by main reason for taking loan",
  yaxis = "",
  xaxis = "% of loans",
  caption =  paste(CAPTION)
) 

pal <- c(PALETTES[[names(groups[1])]], PALETTES[[names(groups[2])]])
fig_bar_loan_reasons(loans_data, indicators, slicevar, groups, plot_text, palette = pal) + theme(strip.text.x = element_text(face = "bold"))

```


In 2021, borrowers in Kenya cited convenience and ease of obtaining a loan as the primary reasons for considering a lender their most important. Fuliza had the highest percentage of borrowers (60%) valuing convenience, followed by mobile banks (50%) and fintech apps (42%) (@fig-valuedfeatures). Affordability, in terms of low fees and repayments, was another significant factor, especially for SACCOs/MFIs (25%). Ease of use and the ability to make repayments were particularly important for borrowers from informal sources such as social networks (37%), shopkeepers (23%) and employers or buyers (32%), which likely appreciate the flexibility these lenders can afford. Features suited to individual needs, including privacy, were a key consideration for borrowers using fintech apps (34%) and personal or business loans from bank (31%). Trust is rarely cited as a reason people value a lender, with the highest being employer or buyer loans (12%). Overall, the data highlights that while convenience remains the predominant factor in lender importance, affordability and ease of repayments also play crucial roles in shaping borrower preferences.


```{r, fig.width = 12, fig.asp = 0.66}
#| label: fig-valuedfeatures
#| echo: false
#| warning: false
#| fig-cap: "Loan features valued by borrowers, 2021"

# LEFT PANEL
indicators_left <- c("mimp_loan_agg3_")
groups_left <- c("fullsample" = "All borrowers")
plot_text_left <- list(
  title = "Figure 18A",
  subtitle  = "Most important loan\n(% of borrowers)",
  caption =  NULL
) 

# RIGHT PANEL
indicators_right <- c("mimp_reason_1", "mimp_reason_2", "mimp_reason_3", "mimp_reason_4", "mimp_reason_5", "mimp_reason_6", "mimp_reason_7", "mimp_reason_8")
groups_right <- c("mimp_loan_agg3_str" = "Most important loan")
plot_text_right <- list(
  title =  "Figure 18B",
  subtitle = "Reason loan is the most important\n(% of borrowers of lender, row adds to 100%)",
  caption = NULL
) 

fig_comp_borrower_by_mostimplloan(borrower_data, indicators_left, groups_left, indicators_right, groups_right, plot_text_left, plot_text_right)

```

## 4. How many adults have difficulty repaying debt and why?

Between 2019 and 2021, the percentage of adults with some outstanding debt rose from 40.6% to 49.5% and the median outstanding debt rose from KSh 800 in 2019 to KSh 1,800 in 2021. Total outstanding debt as a share of personal monthly income among borrowers rose from 15% in 2019 to 32% in 2021 (@fig-debtstatus).

```{r, fig.width = 12, fig.asp = 0.75}
#| label: fig-debtstatus
#| echo: false
#| warning: false
#| fig-cap: "Debt and delinquencies by lender, 2019 and 2021"

  indicators <- c("has_recent_loan", "has_debt", "debt_balance_cd", "debt_balance_income_cd")
  groups <- c("lender_agg3_str" = "Source of loan")
  slicevar <- c("Year" = "year_fct")
  
  notes <- c("*Delinquent payment is not comparable across 2019 and 2021. In 2019, respondents were asked to report whether they had 'defaulted' on a loan by lender, whereas in 2021, respondents were asked to report whether they had 'paid late, missed a payment, paid less or never paid' by lender.")
    
  plot_text <- list(
  title = "Figure 19",
  subtitle = "Borrowing and debt status by lender, 2019 and 2021",
  yaxis = NULL, 
  xaxis = NULL,  
  caption = str_wrap(paste0(CAPTION, notes), 120)
) 
  
  fig_tile_debt_overview(respdebt_data_pool, borrower_data_pool, indicators, slicevar, groups, plot_text) + theme(strip.text.x = element_text(face = "bold")) + geom_hline(yintercept = 13.5, color = "black", size = 0.75)

```

In 2021, about 1 in 3 Kenyan adults were either having trouble repaying on time or in full (delinquent) or had to resort to adverse repayment strategies (such as reducing food expenditures, selling assets or borrowing more) (@fig-debtstress). Overall the prevalence of debt stress rose between 2019 to 2021 from 31 to 34%,  rising most sharply among the richest 20% of adults. 

In 2019, 17.4 % of borrowers reported that they had defaulted at least once on a loan in the past year. In 2021, 58% of borrowers reported they had either "paid late, missed a payment, paid less or never paid" a loan in the past year (@fig-debtstatus). In 2021, the highest incidence of delinquent repayment behavior was associated with mobile banking loans (74%), social network loanss (64%) and apps (63%) while the lowest incidence of delinquent repayment behavior was associated with shopkeeper credit (21.%).

In 2021, "Using up all my money for basic needs" (46%) and "Did not plan well enought" (26%) were the two main reasons for failure to repay a loan on time and as agreed. Income declines and poor business performance were also signifant factors, particularly among adults in the highest income quintile. While the data for 2019 is not strictly consistent with 2021 as the reasons were collected for borrowers who reported defaulting on a loan, the patterns suggest the increasing role (from 2019 to 2021) of expenditure pressures forcing borrowers to prioritize basic consumption over debt repayment. 


```{r, fig.width = 12, fig.asp = 1}
#| label: fig-debtstress
#| echo: false
#| warning: false
#| fig-cap: "Prevalence of debt stress and reasons for loan defaults and delinquency, 2019 and 2021"

plot_text <- list(
  title1 = "Figure 20A",
  title2 = "Figure 20B"
) 

slicevar <- c("Year" = "year_fct")
  
fig_comp_debtstress(borrower_data_pool, slicevar, plot_text)

```




